require 'test_helper'

describe Event do
  it "should group votes into buckets" do
    event = create(:event)
    create(:vote, event: event, vote_type: VoteType::THUMBS_UP, created_at: event.start_time)
    create(:vote, event: event, vote_type: VoteType::THUMBS_UP, created_at: event.start_time)
    create(:vote, event: event, vote_type: VoteType::THUMBS_UP, created_at: event.start_time)

    create(:vote, event: event, vote_type: VoteType::THUMBS_UP, created_at: event.start_time + 1.second)

    create(:vote, event: event, vote_type: VoteType::THUMBS_DOWN, created_at: event.start_time)
    create(:vote, event: event, vote_type: VoteType::THUMBS_DOWN, created_at: event.start_time)
    create(:vote, event: event, vote_type: VoteType::THUMBS_DOWN, created_at: event.start_time)
    create(:vote, event: event, vote_type: VoteType::THUMBS_DOWN, created_at: event.start_time)

    create(:vote, event: event, vote_type: VoteType::THUMBS_DOWN, created_at: event.start_time + 1.second)

    hash = event.group_votes_by_timestamp(event.start_time, event.votes)

    hash["thumbs-up"][0].must_equal 3
    hash["thumbs-up"][1].must_equal 1
    hash["thumbs-down"][0].must_equal 4
    hash["thumbs-down"][1].must_equal 1
  end

  it "should layer votes on the initial chart" do
    chart = [{:title=>"thumbs-up", :points=>[{:x=>0, :y=>0}, {:x=>1, :y=>0}, {:x=>2, :y=>0}, {:x=>3, :y=>0}, {:x=>4, :y=>0}, {:x=>5, :y=>0}, {:x=>6, :y=>0}, {:x=>7, :y=>0}, {:x=>8, :y=>0}, {:x=>9, :y=>0}, {:x=>10, :y=>0}, {:x=>11, :y=>0}, {:x=>12, :y=>0}, {:x=>13, :y=>0}, {:x=>14, :y=>0}, {:x=>15, :y=>0}, {:x=>16, :y=>0}, {:x=>17, :y=>0}, {:x=>18, :y=>0}, {:x=>19, :y=>0}, {:x=>20, :y=>0}, {:x=>21, :y=>0}, {:x=>22, :y=>0}, {:x=>23, :y=>0}, {:x=>24, :y=>0}, {:x=>25, :y=>0}, {:x=>26, :y=>0}, {:x=>27, :y=>0}, {:x=>28, :y=>0}, {:x=>29, :y=>0}, {:x=>30, :y=>0}, {:x=>31, :y=>0}, {:x=>32, :y=>0}, {:x=>33, :y=>0}, {:x=>34, :y=>0}, {:x=>35, :y=>0}, {:x=>36, :y=>0}, {:x=>37, :y=>0}, {:x=>38, :y=>0}, {:x=>39, :y=>0}, {:x=>40, :y=>0}, {:x=>41, :y=>0}, {:x=>42, :y=>0}, {:x=>43, :y=>0}, {:x=>44, :y=>0}, {:x=>45, :y=>0}, {:x=>46, :y=>0}, {:x=>47, :y=>0}, {:x=>48, :y=>0}, {:x=>49, :y=>0}, {:x=>50, :y=>0}, {:x=>51, :y=>0}, {:x=>52, :y=>0}, {:x=>53, :y=>0}, {:x=>54, :y=>0}, {:x=>55, :y=>0}, {:x=>56, :y=>0}, {:x=>57, :y=>0}, {:x=>58, :y=>0}, {:x=>59, :y=>0}, {:x=>60, :y=>0}, {:x=>61, :y=>0}, {:x=>62, :y=>0}, {:x=>63, :y=>0}, {:x=>64, :y=>0}, {:x=>65, :y=>0}, {:x=>66, :y=>0}, {:x=>67, :y=>0}, {:x=>68, :y=>0}, {:x=>69, :y=>0}, {:x=>70, :y=>0}, {:x=>71, :y=>0}, {:x=>72, :y=>0}, {:x=>73, :y=>0}, {:x=>74, :y=>0}, {:x=>75, :y=>0}, {:x=>76, :y=>0}, {:x=>77, :y=>0}, {:x=>78, :y=>0}, {:x=>79, :y=>0}, {:x=>80, :y=>0}, {:x=>81, :y=>0}, {:x=>82, :y=>0}, {:x=>83, :y=>0}, {:x=>84, :y=>0}, {:x=>85, :y=>0}, {:x=>86, :y=>0}, {:x=>87, :y=>0}, {:x=>88, :y=>0}, {:x=>89, :y=>0}, {:x=>90, :y=>0}, {:x=>91, :y=>0}, {:x=>92, :y=>0}, {:x=>93, :y=>0}, {:x=>94, :y=>0}, {:x=>95, :y=>0}, {:x=>96, :y=>0}, {:x=>97, :y=>0}, {:x=>98, :y=>0}, {:x=>99, :y=>0}, {:x=>100, :y=>0}, {:x=>101, :y=>0}, {:x=>102, :y=>0}, {:x=>103, :y=>0}, {:x=>104, :y=>0}, {:x=>105, :y=>0}, {:x=>106, :y=>0}, {:x=>107, :y=>0}, {:x=>108, :y=>0}, {:x=>109, :y=>0}, {:x=>110, :y=>0}, {:x=>111, :y=>0}, {:x=>112, :y=>0}, {:x=>113, :y=>0}, {:x=>114, :y=>0}]}, {:title=>"thumbs-down", :points=>[{:x=>0, :y=>0}, {:x=>1, :y=>0}, {:x=>2, :y=>0}, {:x=>3, :y=>0}, {:x=>4, :y=>0}, {:x=>5, :y=>0}, {:x=>6, :y=>0}, {:x=>7, :y=>0}, {:x=>8, :y=>0}, {:x=>9, :y=>0}, {:x=>10, :y=>0}, {:x=>11, :y=>0}, {:x=>12, :y=>0}, {:x=>13, :y=>0}, {:x=>14, :y=>0}, {:x=>15, :y=>0}, {:x=>16, :y=>0}, {:x=>17, :y=>0}, {:x=>18, :y=>0}, {:x=>19, :y=>0}, {:x=>20, :y=>0}, {:x=>21, :y=>0}, {:x=>22, :y=>0}, {:x=>23, :y=>0}, {:x=>24, :y=>0}, {:x=>25, :y=>0}, {:x=>26, :y=>0}, {:x=>27, :y=>0}, {:x=>28, :y=>0}, {:x=>29, :y=>0}, {:x=>30, :y=>0}, {:x=>31, :y=>0}, {:x=>32, :y=>0}, {:x=>33, :y=>0}, {:x=>34, :y=>0}, {:x=>35, :y=>0}, {:x=>36, :y=>0}, {:x=>37, :y=>0}, {:x=>38, :y=>0}, {:x=>39, :y=>0}, {:x=>40, :y=>0}, {:x=>41, :y=>0}, {:x=>42, :y=>0}, {:x=>43, :y=>0}, {:x=>44, :y=>0}, {:x=>45, :y=>0}, {:x=>46, :y=>0}, {:x=>47, :y=>0}, {:x=>48, :y=>0}, {:x=>49, :y=>0}, {:x=>50, :y=>0}, {:x=>51, :y=>0}, {:x=>52, :y=>0}, {:x=>53, :y=>0}, {:x=>54, :y=>0}, {:x=>55, :y=>0}, {:x=>56, :y=>0}, {:x=>57, :y=>0}, {:x=>58, :y=>0}, {:x=>59, :y=>0}, {:x=>60, :y=>0}, {:x=>61, :y=>0}, {:x=>62, :y=>0}, {:x=>63, :y=>0}, {:x=>64, :y=>0}, {:x=>65, :y=>0}, {:x=>66, :y=>0}, {:x=>67, :y=>0}, {:x=>68, :y=>0}, {:x=>69, :y=>0}, {:x=>70, :y=>0}, {:x=>71, :y=>0}, {:x=>72, :y=>0}, {:x=>73, :y=>0}, {:x=>74, :y=>0}, {:x=>75, :y=>0}, {:x=>76, :y=>0}, {:x=>77, :y=>0}, {:x=>78, :y=>0}, {:x=>79, :y=>0}, {:x=>80, :y=>0}, {:x=>81, :y=>0}, {:x=>82, :y=>0}, {:x=>83, :y=>0}, {:x=>84, :y=>0}, {:x=>85, :y=>0}, {:x=>86, :y=>0}, {:x=>87, :y=>0}, {:x=>88, :y=>0}, {:x=>89, :y=>0}, {:x=>90, :y=>0}, {:x=>91, :y=>0}, {:x=>92, :y=>0}, {:x=>93, :y=>0}, {:x=>94, :y=>0}, {:x=>95, :y=>0}, {:x=>96, :y=>0}, {:x=>97, :y=>0}, {:x=>98, :y=>0}, {:x=>99, :y=>0}, {:x=>100, :y=>0}, {:x=>101, :y=>0}, {:x=>102, :y=>0}, {:x=>103, :y=>0}, {:x=>104, :y=>0}, {:x=>105, :y=>0}, {:x=>106, :y=>0}, {:x=>107, :y=>0}, {:x=>108, :y=>0}, {:x=>109, :y=>0}, {:x=>110, :y=>0}, {:x=>111, :y=>0}, {:x=>112, :y=>0}, {:x=>113, :y=>0}, {:x=>114, :y=>0}]}, {:title=>"love-it", :points=>[{:x=>0, :y=>0}, {:x=>1, :y=>0}, {:x=>2, :y=>0}, {:x=>3, :y=>0}, {:x=>4, :y=>0}, {:x=>5, :y=>0}, {:x=>6, :y=>0}, {:x=>7, :y=>0}, {:x=>8, :y=>0}, {:x=>9, :y=>0}, {:x=>10, :y=>0}, {:x=>11, :y=>0}, {:x=>12, :y=>0}, {:x=>13, :y=>0}, {:x=>14, :y=>0}, {:x=>15, :y=>0}, {:x=>16, :y=>0}, {:x=>17, :y=>0}, {:x=>18, :y=>0}, {:x=>19, :y=>0}, {:x=>20, :y=>0}, {:x=>21, :y=>0}, {:x=>22, :y=>0}, {:x=>23, :y=>0}, {:x=>24, :y=>0}, {:x=>25, :y=>0}, {:x=>26, :y=>0}, {:x=>27, :y=>0}, {:x=>28, :y=>0}, {:x=>29, :y=>0}, {:x=>30, :y=>0}, {:x=>31, :y=>0}, {:x=>32, :y=>0}, {:x=>33, :y=>0}, {:x=>34, :y=>0}, {:x=>35, :y=>0}, {:x=>36, :y=>0}, {:x=>37, :y=>0}, {:x=>38, :y=>0}, {:x=>39, :y=>0}, {:x=>40, :y=>0}, {:x=>41, :y=>0}, {:x=>42, :y=>0}, {:x=>43, :y=>0}, {:x=>44, :y=>0}, {:x=>45, :y=>0}, {:x=>46, :y=>0}, {:x=>47, :y=>0}, {:x=>48, :y=>0}, {:x=>49, :y=>0}, {:x=>50, :y=>0}, {:x=>51, :y=>0}, {:x=>52, :y=>0}, {:x=>53, :y=>0}, {:x=>54, :y=>0}, {:x=>55, :y=>0}, {:x=>56, :y=>0}, {:x=>57, :y=>0}, {:x=>58, :y=>0}, {:x=>59, :y=>0}, {:x=>60, :y=>0}, {:x=>61, :y=>0}, {:x=>62, :y=>0}, {:x=>63, :y=>0}, {:x=>64, :y=>0}, {:x=>65, :y=>0}, {:x=>66, :y=>0}, {:x=>67, :y=>0}, {:x=>68, :y=>0}, {:x=>69, :y=>0}, {:x=>70, :y=>0}, {:x=>71, :y=>0}, {:x=>72, :y=>0}, {:x=>73, :y=>0}, {:x=>74, :y=>0}, {:x=>75, :y=>0}, {:x=>76, :y=>0}, {:x=>77, :y=>0}, {:x=>78, :y=>0}, {:x=>79, :y=>0}, {:x=>80, :y=>0}, {:x=>81, :y=>0}, {:x=>82, :y=>0}, {:x=>83, :y=>0}, {:x=>84, :y=>0}, {:x=>85, :y=>0}, {:x=>86, :y=>0}, {:x=>87, :y=>0}, {:x=>88, :y=>0}, {:x=>89, :y=>0}, {:x=>90, :y=>0}, {:x=>91, :y=>0}, {:x=>92, :y=>0}, {:x=>93, :y=>0}, {:x=>94, :y=>0}, {:x=>95, :y=>0}, {:x=>96, :y=>0}, {:x=>97, :y=>0}, {:x=>98, :y=>0}, {:x=>99, :y=>0}, {:x=>100, :y=>0}, {:x=>101, :y=>0}, {:x=>102, :y=>0}, {:x=>103, :y=>0}, {:x=>104, :y=>0}, {:x=>105, :y=>0}, {:x=>106, :y=>0}, {:x=>107, :y=>0}, {:x=>108, :y=>0}, {:x=>109, :y=>0}, {:x=>110, :y=>0}, {:x=>111, :y=>0}, {:x=>112, :y=>0}, {:x=>113, :y=>0}, {:x=>114, :y=>0}]}, {:title=>"im-confused", :points=>[{:x=>0, :y=>0}, {:x=>1, :y=>0}, {:x=>2, :y=>0}, {:x=>3, :y=>0}, {:x=>4, :y=>0}, {:x=>5, :y=>0}, {:x=>6, :y=>0}, {:x=>7, :y=>0}, {:x=>8, :y=>0}, {:x=>9, :y=>0}, {:x=>10, :y=>0}, {:x=>11, :y=>0}, {:x=>12, :y=>0}, {:x=>13, :y=>0}, {:x=>14, :y=>0}, {:x=>15, :y=>0}, {:x=>16, :y=>0}, {:x=>17, :y=>0}, {:x=>18, :y=>0}, {:x=>19, :y=>0}, {:x=>20, :y=>0}, {:x=>21, :y=>0}, {:x=>22, :y=>0}, {:x=>23, :y=>0}, {:x=>24, :y=>0}, {:x=>25, :y=>0}, {:x=>26, :y=>0}, {:x=>27, :y=>0}, {:x=>28, :y=>0}, {:x=>29, :y=>0}, {:x=>30, :y=>0}, {:x=>31, :y=>0}, {:x=>32, :y=>0}, {:x=>33, :y=>0}, {:x=>34, :y=>0}, {:x=>35, :y=>0}, {:x=>36, :y=>0}, {:x=>37, :y=>0}, {:x=>38, :y=>0}, {:x=>39, :y=>0}, {:x=>40, :y=>0}, {:x=>41, :y=>0}, {:x=>42, :y=>0}, {:x=>43, :y=>0}, {:x=>44, :y=>0}, {:x=>45, :y=>0}, {:x=>46, :y=>0}, {:x=>47, :y=>0}, {:x=>48, :y=>0}, {:x=>49, :y=>0}, {:x=>50, :y=>0}, {:x=>51, :y=>0}, {:x=>52, :y=>0}, {:x=>53, :y=>0}, {:x=>54, :y=>0}, {:x=>55, :y=>0}, {:x=>56, :y=>0}, {:x=>57, :y=>0}, {:x=>58, :y=>0}, {:x=>59, :y=>0}, {:x=>60, :y=>0}, {:x=>61, :y=>0}, {:x=>62, :y=>0}, {:x=>63, :y=>0}, {:x=>64, :y=>0}, {:x=>65, :y=>0}, {:x=>66, :y=>0}, {:x=>67, :y=>0}, {:x=>68, :y=>0}, {:x=>69, :y=>0}, {:x=>70, :y=>0}, {:x=>71, :y=>0}, {:x=>72, :y=>0}, {:x=>73, :y=>0}, {:x=>74, :y=>0}, {:x=>75, :y=>0}, {:x=>76, :y=>0}, {:x=>77, :y=>0}, {:x=>78, :y=>0}, {:x=>79, :y=>0}, {:x=>80, :y=>0}, {:x=>81, :y=>0}, {:x=>82, :y=>0}, {:x=>83, :y=>0}, {:x=>84, :y=>0}, {:x=>85, :y=>0}, {:x=>86, :y=>0}, {:x=>87, :y=>0}, {:x=>88, :y=>0}, {:x=>89, :y=>0}, {:x=>90, :y=>0}, {:x=>91, :y=>0}, {:x=>92, :y=>0}, {:x=>93, :y=>0}, {:x=>94, :y=>0}, {:x=>95, :y=>0}, {:x=>96, :y=>0}, {:x=>97, :y=>0}, {:x=>98, :y=>0}, {:x=>99, :y=>0}, {:x=>100, :y=>0}, {:x=>101, :y=>0}, {:x=>102, :y=>0}, {:x=>103, :y=>0}, {:x=>104, :y=>0}, {:x=>105, :y=>0}, {:x=>106, :y=>0}, {:x=>107, :y=>0}, {:x=>108, :y=>0}, {:x=>109, :y=>0}, {:x=>110, :y=>0}, {:x=>111, :y=>0}, {:x=>112, :y=>0}, {:x=>113, :y=>0}, {:x=>114, :y=>0}]}]
    votes_hash = {"thumbs-up"=>{78=>1, 90=>1, 93=>1, 96=>1, 103=>1, 104=>1, 105=>1, 106=>3, 107=>2, 108=>1}, "thumbs-down"=>{80=>1, 87=>1}, "love-it"=>{84=>1, 100=>1}, "im-confused"=>{82=>1, 98=>1}}

    Event.new.layer_votes_on_chart(votes_hash, chart)

    chart.first[:points][0][:y].must_equal 0
    chart.first[:points][90][:y].must_equal 1
    chart.first[:points][106][:y].must_equal 3
  end
end
